{% extends 'blog_automation/base.html' %} {% load blog_filters %} {% block title
%}{{ blog_gen.title }} - Blog Details {% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>{{ blog_gen.title }}</h2>
      <div class="btn-group">
        {% if blog_gen.status == 'completed' and blog_gen.doc_file_path %}
        <a
          href="{% url 'blog_automation:download_blog' blog_gen.id %}"
          class="btn btn-success"
        >
          <i class="fas fa-download me-2"></i>Download DOC
        </a>
        {% endif %}
        <a
          href="{% url 'blog_automation:home' %}"
          class="btn btn-outline-primary"
        >
          <i class="fas fa-arrow-left me-2"></i>Back to Home
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Blog Information -->
  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-info-circle me-2"></i>Blog Information
        </h5>
      </div>
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-5">Status:</dt>
          <dd class="col-sm-7">
            <span class="badge status-badge status-{{ blog_gen.status }}">
              {{ blog_gen.get_status_display }}
            </span>
          </dd>

          <dt class="col-sm-5">Primary Keywords:</dt>
          <dd class="col-sm-7">{{ blog_gen.primary_keywords }}</dd>

          {% if blog_gen.secondary_keywords %}
          <dt class="col-sm-5">Secondary Keywords:</dt>
          <dd class="col-sm-7">{{ blog_gen.secondary_keywords }}</dd>
          {% endif %} {% if blog_gen.target_length %}
          <dt class="col-sm-5">Target Length:</dt>
          <dd class="col-sm-7">{{ blog_gen.target_length }}</dd>
          {% endif %}

          <dt class="col-sm-5">Competitors:</dt>
          <dd class="col-sm-7">{{ blog_gen.num_competitors }}</dd>

          {% if blog_gen.word_count %}
          <dt class="col-sm-5">Word Count:</dt>
          <dd class="col-sm-7">{{ blog_gen.word_count }}</dd>
          {% endif %}

          <dt class="col-sm-5">Created:</dt>
          <dd class="col-sm-7">{{ blog_gen.created_at|date:"M d, Y H:i" }}</dd>

          <dt class="col-sm-5">Updated:</dt>
          <dd class="col-sm-7">{{ blog_gen.updated_at|date:"M d, Y H:i" }}</dd>
        </dl>

        {% if blog_gen.blog_outline %}
        <div class="mt-3">
          <h6><i class="fas fa-list-ul me-2"></i>Custom Outline:</h6>
          <div class="bg-light p-2 rounded small">
            {{ blog_gen.blog_outline|linebreaks }}
          </div>
        </div>
        {% endif %} {% if blog_gen.error_message %}
        <div class="alert alert-danger mt-3">
          <strong>Error:</strong><br />
          {{ blog_gen.error_message }}
        </div>
        {% endif %}

        <div class="d-grid gap-2 mt-3">
          <a
            href="{% url 'blog_automation:delete_blog' blog_gen.id %}"
            class="btn btn-outline-danger btn-sm"
          >
            <i class="fas fa-trash me-2"></i>Delete Blog
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Blog Content -->
  <div class="col-lg-8">
    {% if blog_gen.status == 'completed' and blog_gen.formatted_post %}
    <div class="card">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <h5 class="card-title mb-0">
          <i class="fas fa-file-alt me-2"></i>Generated Content
        </h5>
        <div class="btn-group">
          <button
            class="btn btn-outline-primary btn-sm"
            onclick="copyContent()"
            title="Copy content to clipboard"
          >
            <i class="fas fa-copy me-2"></i>Copy
          </button>
          <button
            class="btn btn-outline-secondary btn-sm"
            onclick="togglePreview()"
          >
            <i class="fas fa-eye me-2"></i>Toggle Preview
          </button>
        </div>
      </div>
      <div class="card-body">
        <div id="contentPreview" class="content-preview">
          {{ blog_gen.formatted_post }}
        </div>
      </div>
    </div>

    {% if blog_gen.blog_outline %}
    <div class="card mt-4">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-list me-2"></i>Blog Analysis Data
        </h5>
      </div>
      <div class="card-body">
        <div class="accordion" id="analysisAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#blogOutline"
              >
                Blog Outline & SEO Data
              </button>
            </h2>
            <div
              id="blogOutline"
              class="accordion-collapse collapse"
              data-bs-parent="#analysisAccordion"
            >
              <div class="accordion-body">
                <pre
                  class="bg-light p-3 rounded"
                ><code>{{ blog_gen.blog_outline|pprint }}</code></pre>
              </div>
            </div>
          </div>

          {% if blog_gen.competitor_analysis %}
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#competitorAnalysis"
              >
                Competitor Analysis
              </button>
            </h2>
            <div
              id="competitorAnalysis"
              class="accordion-collapse collapse"
              data-bs-parent="#analysisAccordion"
            >
              <div class="accordion-body">
                <pre
                  class="bg-light p-3 rounded"
                ><code>{{ blog_gen.competitor_analysis|pprint }}</code></pre>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %} {% elif blog_gen.status == 'processing' %}
    <div class="card">
      <div class="card-body text-center">
        <div class="progress-spinner me-2"></div>
        <h5>Generating blog content...</h5>
        <p class="text-muted">This may take several minutes. Please wait.</p>

        <button class="btn btn-outline-primary" onclick="location.reload()">
          <i class="fas fa-sync me-2"></i>Refresh Status
        </button>
      </div>
    </div>

    {% elif blog_gen.status == 'pending' %}
    <div class="card">
      <div class="card-body text-center">
        <h5>Blog generation not started</h5>
        <p class="text-muted">
          Click the button below to start generating your blog post.
        </p>

        <a
          href="{% url 'blog_automation:generate_blog' blog_gen.id %}"
          class="btn btn-primary"
        >
          <i class="fas fa-magic me-2"></i>Start Generation
        </a>
      </div>
    </div>

    {% elif blog_gen.status == 'failed' %}
    <div class="card">
      <div class="card-body text-center">
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Blog generation failed
        </div>

        <a
          href="{% url 'blog_automation:generate_blog' blog_gen.id %}"
          class="btn btn-warning"
        >
          <i class="fas fa-redo me-2"></i>Try Again
        </a>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  function togglePreview() {
    const preview = document.getElementById("contentPreview");
    if (preview.style.display === "none") {
      preview.style.display = "block";
    } else {
      preview.style.display = "none";
    }
  }

  async function copyContent() {
    try {
      const contentElement = document.getElementById("contentPreview");

      // Get the text content without HTML tags
      const textContent =
        contentElement.innerText || contentElement.textContent;

      // Use the modern Clipboard API
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(textContent);
        showCopyFeedback(true);
      } else {
        // Fallback for older browsers
        const textArea = document.createElement("textarea");
        textArea.value = textContent;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        textArea.style.top = "-999999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        const successful = document.execCommand("copy");
        document.body.removeChild(textArea);

        showCopyFeedback(successful);
      }
    } catch (err) {
      console.error("Failed to copy content: ", err);
      showCopyFeedback(false);
    }
  }

  function showCopyFeedback(success) {
    const button = event.target.closest("button");
    const icon = button.querySelector("i");
    const originalContent = button.innerHTML;

    if (success) {
      button.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
      button.classList.remove("btn-outline-primary");
      button.classList.add("btn-success");

      setTimeout(() => {
        button.innerHTML = originalContent;
        button.classList.remove("btn-success");
        button.classList.add("btn-outline-primary");
      }, 2000);
    } else {
      button.innerHTML = '<i class="fas fa-exclamation me-2"></i>Failed';
      button.classList.remove("btn-outline-primary");
      button.classList.add("btn-danger");

      setTimeout(() => {
        button.innerHTML = originalContent;
        button.classList.remove("btn-danger");
        button.classList.add("btn-outline-primary");
      }, 2000);
    }
  }
</script>
{% endblock %}
